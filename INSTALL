
Install CentOS 7, minimal installation
- Disable SELinux in /etc/sysconfig/selinux

Configure udev:
Create file /etc/udev/rules.d/99-custom.rules
   ACTION=="add|change", KERNEL=="sd[a-z]", ATTR{queue/scheduler}="noop"
and run
   udevadm trigger

Add packages:
	epel-release
do yum update
Add packages
	open-vm-tools
	wget
	firewalld
	mariadb
	mariadb-server
	perl-WWW-Curl
	perl-Linux-Inotify2
	perl-Date-Manip
	perl-Sys-Syslog
	perl-DBI
	perl-JSON
	perl-JSON-XS
	perl-Parallel-ForkManager
	perl-Archive-Zip
	perl-Net-SFTP-Foreign

Configure:

postfix:
	myhostname
	mydomain
	relayhost

users:
	groupadd gnss
	useradd -d /home/gpsuser -G gnss gpsuser
	useradd -d /data/ftp gnss3
	chgrp gnss /data/ftp
	chmod 775 /data/ftp

mariadb:
	Create /data/mysql
	Modify /etc/my.cnf.d/server.cnf
		Add "datadir = /data/mysql" in [server] section
	systemctl enable mariadb
	systemctl start mariadb
	Run "mysql_secure_installation"
	Create gpsuser
		mysql -u root -p mysql
		create database gps;
		create user gpsuser@localhost identifyed by 'gpsuser';
		grant all privileges on gps.* to gpsuser@localhost;
	Check local access with:
		# mysql -u gpsuser -pgpsuser gps     (should be able to login)
	Run SQL script
		\. /home/gpsuser/sql/create-siteconfig.sql
		show tables;
	Should display:
		+---------------+
		| Tables_in_gps |
		+---------------+
		| antennas      |
		| locations     |
		  .....
		| receivers     |
		| siteconfig    |
		+---------------+

firewall:
	CentOS 7 default firewall is firewall-cmd

	Initial install: Add new zone with
		firewall-cmd --permanent --new-zone=gnss
		firewall-cmd --permanent --set-default-zone=gnss
		firewall-cmd --permanent --add-service=ftp --add-service=http --add-service=https
		firewall-cmd --permanent --add-source=x.x.x.x/x   (where x.x.x.x/x is your local nets)
		firewall-cmd --reload

	When adding allowed sources
		firewall-cmd --permanent --add-source=1.2.3.4/32
		firewall-cmd --reload

mount datastore:
	mkdir /data
	Mount data disk on /data

services:
	git clone scripts from https://github.com/Kortforsyningen/GORM.git
	Move content to /home/gpsuser
	chown -R gpsuser:gpsuser /home/gpsuser
	Copy conf/*.service to /etc/systemd/system
	Enable and start services:
		systemctl daemon-reload
		systemctl enable gpspickup jobengine ftpuploader
		systemctl start gpspickup jobengine ftpuploader
